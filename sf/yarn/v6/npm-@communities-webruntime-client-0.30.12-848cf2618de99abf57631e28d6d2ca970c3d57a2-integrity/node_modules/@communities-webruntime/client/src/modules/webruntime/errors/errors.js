/**
 * Copyright (c) 2019, salesforce.com, inc.
 * All rights reserved.
 * SPDX-License-Identifier: MIT
 * For full license text, see the LICENSE file in the repo root or https://opensource.org/licenses/MIT
 */
import { logError } from 'webruntime/logger';
import { ERRORS_PATH_PREFIX } from '@communities-webruntime/common';
import { sendBeacon } from 'webruntime/transport';

function sendError(payload) {
    const { hostname, pathname } = window.location;
    sendBeacon({
        path: ERRORS_PATH_PREFIX,
        payload: JSON.stringify({ ...payload, location: { hostname, pathname } }),
        contentType: 'text/plain;charset=UTF-8',
    });
}

function reportError({ subject, error, wcstack }) {
    wcstack = wcstack || error.wcstack;
    logError(subject, '\nerror: ', error, '\nwcstack:\n', wcstack);
    const { message, stack } = error;
    sendError({
        subject,
        message,
        stack,
        wcstack,
    });
}

export { reportError };
