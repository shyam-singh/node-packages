/**
 * Copyright (c) 2020, salesforce.com, inc.
 * All rights reserved.
 * SPDX-License-Identifier: MIT
 * For full license text, see the LICENSE file in the repo root or https://opensource.org/licenses/MIT
 */

import 'es-module-shims';
import '@lwc/synthetic-shadow';

const LOADER_SPECIFIER = 'webruntime_loader/loader';

// Create a dynamic loader "module" that re-exports the dynamic import shim
//  <script type="webruntime-module" src="<blob url>"></script>
const loader = `
    const load = window.importShim;
    delete window.importShim;
    export { load };
`;
const blob = new Blob([loader], { type: 'application/javascript' });
const loaderScript = document.createElement('script');
const blobURL = URL.createObjectURL(blob);
loaderScript.src = blobURL;
loaderScript.type = 'webruntime-module';
document.head.prepend(loaderScript);

// Create a import map that points to the loader blob
const importMap = {
    imports: {
        [LOADER_SPECIFIER]: blobURL,
    },
};
const importMapScript = document.createElement('script');
importMapScript.type = 'webruntime-importmap';
importMapScript.innerText = JSON.stringify(importMap);
document.head.prepend(importMapScript);
