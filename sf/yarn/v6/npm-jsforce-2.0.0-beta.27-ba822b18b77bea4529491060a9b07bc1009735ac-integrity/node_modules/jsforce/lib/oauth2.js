"use strict";

var _interopRequireWildcard = require("@babel/runtime-corejs3/helpers/interopRequireWildcard");
var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");
var _Object$defineProperty = require("@babel/runtime-corejs3/core-js-stable/object/define-property");
var _Object$defineProperties = require("@babel/runtime-corejs3/core-js-stable/object/define-properties");
var _Object$getOwnPropertyDescriptors = require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors");
var _forEachInstanceProperty = require("@babel/runtime-corejs3/core-js-stable/instance/for-each");
var _Object$getOwnPropertyDescriptor = require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor");
var _filterInstanceProperty = require("@babel/runtime-corejs3/core-js-stable/instance/filter");
var _Object$getOwnPropertySymbols = require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols");
var _Object$keys = require("@babel/runtime-corejs3/core-js-stable/object/keys");
require("core-js/modules/es.promise");
require("core-js/modules/es.string.replace");
_Object$defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.OAuth2 = void 0;
var _indexOf = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/index-of"));
var _slice = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/slice"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime-corejs3/helpers/defineProperty"));
var _crypto = require("crypto");
var _querystring = _interopRequireDefault(require("querystring"));
var _transport = _interopRequireWildcard(require("./transport"));
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source), true)).call(_context3, function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context4; _forEachInstanceProperty(_context4 = ownKeys(Object(source))).call(_context4, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; } /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */
const defaultOAuth2Config = {
  loginUrl: 'https://login.salesforce.com'
};

// Makes a nodejs base64 encoded string compatible with rfc4648 alternative encoding for urls.
// @param base64Encoded a nodejs base64 encoded string
function base64UrlEscape(base64Encoded) {
  // builtin node js base 64 encoding is not 64 url compatible.
  // See https://toolsn.ietf.org/html/rfc4648#section-5
  return base64Encoded.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
}

/**
 * type defs
 */

/**
 * OAuth2 class
 */
class OAuth2 {
  /**
   *
   */
  constructor(config) {
    (0, _defineProperty2.default)(this, "loginUrl", void 0);
    (0, _defineProperty2.default)(this, "authzServiceUrl", void 0);
    (0, _defineProperty2.default)(this, "tokenServiceUrl", void 0);
    (0, _defineProperty2.default)(this, "revokeServiceUrl", void 0);
    (0, _defineProperty2.default)(this, "clientId", void 0);
    (0, _defineProperty2.default)(this, "clientSecret", void 0);
    (0, _defineProperty2.default)(this, "redirectUri", void 0);
    (0, _defineProperty2.default)(this, "codeVerifier", void 0);
    (0, _defineProperty2.default)(this, "_transport", void 0);
    const {
      loginUrl,
      authzServiceUrl,
      tokenServiceUrl,
      revokeServiceUrl,
      clientId,
      clientSecret,
      redirectUri,
      proxyUrl,
      httpProxy,
      useVerifier
    } = config;
    if (authzServiceUrl && tokenServiceUrl) {
      var _context;
      this.loginUrl = (0, _slice.default)(_context = authzServiceUrl.split('/')).call(_context, 0, 3).join('/');
      this.authzServiceUrl = authzServiceUrl;
      this.tokenServiceUrl = tokenServiceUrl;
      this.revokeServiceUrl = revokeServiceUrl || `${this.loginUrl}/services/oauth2/revoke`;
    } else {
      this.loginUrl = loginUrl || defaultOAuth2Config.loginUrl;
      this.authzServiceUrl = `${this.loginUrl}/services/oauth2/authorize`;
      this.tokenServiceUrl = `${this.loginUrl}/services/oauth2/token`;
      this.revokeServiceUrl = `${this.loginUrl}/services/oauth2/revoke`;
    }
    this.clientId = clientId;
    this.clientSecret = clientSecret;
    this.redirectUri = redirectUri;
    if (proxyUrl) {
      this._transport = new _transport.XdProxyTransport(proxyUrl);
    } else if (httpProxy) {
      this._transport = new _transport.HttpProxyTransport(httpProxy);
    } else {
      this._transport = new _transport.default();
    }
    if (useVerifier) {
      // Set a code verifier string for OAuth authorization
      this.codeVerifier = base64UrlEscape((0, _crypto.randomBytes)(Math.ceil(128)).toString('base64'));
    }
  }

  /**
   * Get Salesforce OAuth2 authorization page URL to redirect user agent.
   */
  getAuthorizationUrl(params = {}) {
    var _context2;
    if (this.codeVerifier) {
      // code verifier must be a base 64 url encoded hash of 128 bytes of random data. Our random data is also
      // base 64 url encoded. See Connection.create();
      const codeChallenge = base64UrlEscape((0, _crypto.createHash)('sha256').update(this.codeVerifier).digest('base64'));
      params.code_challenge = codeChallenge;
    }
    const _params = _objectSpread(_objectSpread({}, params), {}, {
      response_type: 'code',
      client_id: this.clientId,
      redirect_uri: this.redirectUri
    });
    return this.authzServiceUrl + ((0, _indexOf.default)(_context2 = this.authzServiceUrl).call(_context2, '?') >= 0 ? '&' : '?') + _querystring.default.stringify(_params);
  }

  /**
   * OAuth2 Refresh Token Flow
   */
  async refreshToken(refreshToken) {
    if (!this.clientId) {
      throw new Error('No OAuth2 client id information is specified');
    }
    const params = {
      grant_type: 'refresh_token',
      refresh_token: refreshToken,
      client_id: this.clientId
    };
    if (this.clientSecret) {
      params.client_secret = this.clientSecret;
    }
    const ret = await this._postParams(params);
    return ret;
  }

  /**
   * Send access token request to the token endpoint.
   * When a code (string) is passed in first argument, it will use Web Server Authentication Flow (Authorization Code Grant).
   * Otherwise, it will use the specified `grant_type` and pass parameters to the endpoint.
   */
  async requestToken(codeOrParams, params = {}) {
    if (typeof codeOrParams === 'string' && (!this.clientId || !this.redirectUri)) {
      throw new Error('No OAuth2 client id or redirect uri configuration is specified');
    }
    const _params = _objectSpread(_objectSpread({}, params), typeof codeOrParams === 'string' ? {
      grant_type: 'authorization_code',
      code: codeOrParams
    } : codeOrParams);
    if (this.clientId) {
      _params.client_id = this.clientId;
    }
    if (this.clientSecret) {
      _params.client_secret = this.clientSecret;
    }
    if (this.redirectUri) {
      _params.redirect_uri = this.redirectUri;
    }
    const ret = await this._postParams(_params);
    return ret;
  }

  /**
   * OAuth2 Username-Password Flow (Resource Owner Password Credentials)
   */
  async authenticate(username, password) {
    if (!this.clientId || !this.clientSecret || !this.redirectUri) {
      throw new Error('No valid OAuth2 client configuration set');
    }
    const ret = await this._postParams({
      grant_type: 'password',
      username,
      password,
      client_id: this.clientId,
      client_secret: this.clientSecret,
      redirect_uri: this.redirectUri
    });
    return ret;
  }

  /**
   * OAuth2 Revoke Session Token
   */
  async revokeToken(token) {
    const response = await this._transport.httpRequest({
      method: 'POST',
      url: this.revokeServiceUrl,
      body: _querystring.default.stringify({
        token
      }),
      headers: {
        'content-type': 'application/x-www-form-urlencoded'
      }
    });
    if (response.statusCode >= 400) {
      let res = _querystring.default.parse(response.body);
      if (!res || !res.error) {
        res = {
          error: `ERROR_HTTP_${response.statusCode}`,
          error_description: response.body
        };
      }
      throw new class extends Error {
        constructor({
          error,
          error_description
        }) {
          super(error_description);
          this.name = error;
        }
      }(res);
    }
  }

  /**
   * @private
   */
  async _postParams(params) {
    if (this.codeVerifier) params.code_verifier = this.codeVerifier;
    const response = await this._transport.httpRequest({
      method: 'POST',
      url: this.tokenServiceUrl,
      body: _querystring.default.stringify(params),
      headers: {
        'content-type': 'application/x-www-form-urlencoded'
      }
    });
    let res;
    try {
      res = JSON.parse(response.body);
    } catch (e) {
      /* eslint-disable no-empty */
    }
    if (response.statusCode >= 400) {
      res = res || {
        error: `ERROR_HTTP_${response.statusCode}`,
        error_description: response.body
      };
      throw new class extends Error {
        constructor({
          error,
          error_description
        }) {
          super(error_description);
          this.name = error;
        }
      }(res);
    }
    return res;
  }
}
exports.OAuth2 = OAuth2;
var _default = OAuth2;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY3J5cHRvIiwicmVxdWlyZSIsIl9xdWVyeXN0cmluZyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfdHJhbnNwb3J0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJvd25LZXlzIiwib2JqZWN0IiwiZW51bWVyYWJsZU9ubHkiLCJrZXlzIiwiX09iamVjdCRrZXlzIiwiX09iamVjdCRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJzeW1ib2xzIiwiX2ZpbHRlckluc3RhbmNlUHJvcGVydHkiLCJjYWxsIiwic3ltIiwiX09iamVjdCRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJfY29udGV4dDMiLCJfZm9yRWFjaEluc3RhbmNlUHJvcGVydHkiLCJPYmplY3QiLCJrZXkiLCJfZGVmaW5lUHJvcGVydHkyIiwiZGVmYXVsdCIsIl9PYmplY3QkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsIl9PYmplY3QkZGVmaW5lUHJvcGVydGllcyIsIl9jb250ZXh0NCIsIl9PYmplY3QkZGVmaW5lUHJvcGVydHkiLCJkZWZhdWx0T0F1dGgyQ29uZmlnIiwibG9naW5VcmwiLCJiYXNlNjRVcmxFc2NhcGUiLCJiYXNlNjRFbmNvZGVkIiwicmVwbGFjZSIsIk9BdXRoMiIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiYXV0aHpTZXJ2aWNlVXJsIiwidG9rZW5TZXJ2aWNlVXJsIiwicmV2b2tlU2VydmljZVVybCIsImNsaWVudElkIiwiY2xpZW50U2VjcmV0IiwicmVkaXJlY3RVcmkiLCJwcm94eVVybCIsImh0dHBQcm94eSIsInVzZVZlcmlmaWVyIiwiX2NvbnRleHQiLCJfc2xpY2UiLCJzcGxpdCIsImpvaW4iLCJYZFByb3h5VHJhbnNwb3J0IiwiSHR0cFByb3h5VHJhbnNwb3J0IiwiVHJhbnNwb3J0IiwiY29kZVZlcmlmaWVyIiwicmFuZG9tQnl0ZXMiLCJNYXRoIiwiY2VpbCIsInRvU3RyaW5nIiwiZ2V0QXV0aG9yaXphdGlvblVybCIsInBhcmFtcyIsIl9jb250ZXh0MiIsImNvZGVDaGFsbGVuZ2UiLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwiZGlnZXN0IiwiY29kZV9jaGFsbGVuZ2UiLCJfcGFyYW1zIiwicmVzcG9uc2VfdHlwZSIsImNsaWVudF9pZCIsInJlZGlyZWN0X3VyaSIsIl9pbmRleE9mIiwicXVlcnlzdHJpbmciLCJzdHJpbmdpZnkiLCJyZWZyZXNoVG9rZW4iLCJFcnJvciIsImdyYW50X3R5cGUiLCJyZWZyZXNoX3Rva2VuIiwiY2xpZW50X3NlY3JldCIsInJldCIsIl9wb3N0UGFyYW1zIiwicmVxdWVzdFRva2VuIiwiY29kZU9yUGFyYW1zIiwiY29kZSIsImF1dGhlbnRpY2F0ZSIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJyZXZva2VUb2tlbiIsInRva2VuIiwicmVzcG9uc2UiLCJodHRwUmVxdWVzdCIsIm1ldGhvZCIsInVybCIsImJvZHkiLCJoZWFkZXJzIiwic3RhdHVzQ29kZSIsInJlcyIsInBhcnNlIiwiZXJyb3IiLCJlcnJvcl9kZXNjcmlwdGlvbiIsIm5hbWUiLCJjb2RlX3ZlcmlmaWVyIiwiSlNPTiIsImUiLCJleHBvcnRzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyIuLi9zcmMvb2F1dGgyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICpcbiAqL1xuaW1wb3J0IHsgY3JlYXRlSGFzaCwgcmFuZG9tQnl0ZXMgfSBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHF1ZXJ5c3RyaW5nIGZyb20gJ3F1ZXJ5c3RyaW5nJztcbmltcG9ydCBUcmFuc3BvcnQsIHsgWGRQcm94eVRyYW5zcG9ydCwgSHR0cFByb3h5VHJhbnNwb3J0IH0gZnJvbSAnLi90cmFuc3BvcnQnO1xuaW1wb3J0IHsgT3B0aW9uYWwgfSBmcm9tICcuL3R5cGVzJztcblxuY29uc3QgZGVmYXVsdE9BdXRoMkNvbmZpZyA9IHtcbiAgbG9naW5Vcmw6ICdodHRwczovL2xvZ2luLnNhbGVzZm9yY2UuY29tJyxcbn07XG5cbi8vIE1ha2VzIGEgbm9kZWpzIGJhc2U2NCBlbmNvZGVkIHN0cmluZyBjb21wYXRpYmxlIHdpdGggcmZjNDY0OCBhbHRlcm5hdGl2ZSBlbmNvZGluZyBmb3IgdXJscy5cbi8vIEBwYXJhbSBiYXNlNjRFbmNvZGVkIGEgbm9kZWpzIGJhc2U2NCBlbmNvZGVkIHN0cmluZ1xuZnVuY3Rpb24gYmFzZTY0VXJsRXNjYXBlKGJhc2U2NEVuY29kZWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIC8vIGJ1aWx0aW4gbm9kZSBqcyBiYXNlIDY0IGVuY29kaW5nIGlzIG5vdCA2NCB1cmwgY29tcGF0aWJsZS5cbiAgLy8gU2VlIGh0dHBzOi8vdG9vbHNuLmlldGYub3JnL2h0bWwvcmZjNDY0OCNzZWN0aW9uLTVcbiAgcmV0dXJuIGJhc2U2NEVuY29kZWRcbiAgICAucmVwbGFjZSgvXFwrL2csICctJylcbiAgICAucmVwbGFjZSgvXFwvL2csICdfJylcbiAgICAucmVwbGFjZSgvPS9nLCAnJyk7XG59XG5cbi8qKlxuICogdHlwZSBkZWZzXG4gKi9cbmV4cG9ydCB0eXBlIE9BdXRoMkNvbmZpZyA9IHtcbiAgY2xpZW50SWQ/OiBzdHJpbmc7XG4gIGNsaWVudFNlY3JldD86IHN0cmluZztcbiAgcmVkaXJlY3RVcmk/OiBzdHJpbmc7XG4gIGxvZ2luVXJsPzogc3RyaW5nO1xuICBhdXRoelNlcnZpY2VVcmw/OiBzdHJpbmc7XG4gIHRva2VuU2VydmljZVVybD86IHN0cmluZztcbiAgcmV2b2tlU2VydmljZVVybD86IHN0cmluZztcbiAgcHJveHlVcmw/OiBzdHJpbmc7XG4gIGh0dHBQcm94eT86IHN0cmluZztcbiAgdXNlVmVyaWZpZXI/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IHR5cGUgQXV0aHpSZXF1ZXN0UGFyYW1zID0ge1xuICBzY29wZT86IHN0cmluZztcbiAgc3RhdGU/OiBzdHJpbmc7XG4gIGNvZGVfY2hhbGxlbmdlPzogc3RyaW5nO1xufSAmIHtcbiAgW2F0dHI6IHN0cmluZ106IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIFRva2VuUmVzcG9uc2UgPSB7XG4gIHRva2VuX3R5cGU6ICdCZWFyZXInO1xuICBpZDogc3RyaW5nO1xuICBhY2Nlc3NfdG9rZW46IHN0cmluZztcbiAgcmVmcmVzaF90b2tlbj86IHN0cmluZztcbiAgc2lnbmF0dXJlOiBzdHJpbmc7XG4gIGlzc3VlZF9hdDogc3RyaW5nO1xuICBpbnN0YW5jZV91cmw6IHN0cmluZztcbiAgc2ZkY19jb21tdW5pdHlfdXJsPzogc3RyaW5nO1xuICBzZmRjX2NvbW11bml0eV9pZD86IHN0cmluZztcbn07XG5cbi8qKlxuICogT0F1dGgyIGNsYXNzXG4gKi9cbmV4cG9ydCBjbGFzcyBPQXV0aDIge1xuICBsb2dpblVybDogc3RyaW5nO1xuICBhdXRoelNlcnZpY2VVcmw6IHN0cmluZztcbiAgdG9rZW5TZXJ2aWNlVXJsOiBzdHJpbmc7XG4gIHJldm9rZVNlcnZpY2VVcmw6IHN0cmluZztcbiAgY2xpZW50SWQ6IE9wdGlvbmFsPHN0cmluZz47XG4gIGNsaWVudFNlY3JldDogT3B0aW9uYWw8c3RyaW5nPjtcbiAgcmVkaXJlY3RVcmk6IE9wdGlvbmFsPHN0cmluZz47XG4gIGNvZGVWZXJpZmllcjogT3B0aW9uYWw8c3RyaW5nPjtcblxuICBfdHJhbnNwb3J0OiBUcmFuc3BvcnQ7XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25maWc6IE9BdXRoMkNvbmZpZykge1xuICAgIGNvbnN0IHtcbiAgICAgIGxvZ2luVXJsLFxuICAgICAgYXV0aHpTZXJ2aWNlVXJsLFxuICAgICAgdG9rZW5TZXJ2aWNlVXJsLFxuICAgICAgcmV2b2tlU2VydmljZVVybCxcbiAgICAgIGNsaWVudElkLFxuICAgICAgY2xpZW50U2VjcmV0LFxuICAgICAgcmVkaXJlY3RVcmksXG4gICAgICBwcm94eVVybCxcbiAgICAgIGh0dHBQcm94eSxcbiAgICAgIHVzZVZlcmlmaWVyLFxuICAgIH0gPSBjb25maWc7XG4gICAgaWYgKGF1dGh6U2VydmljZVVybCAmJiB0b2tlblNlcnZpY2VVcmwpIHtcbiAgICAgIHRoaXMubG9naW5VcmwgPSBhdXRoelNlcnZpY2VVcmwuc3BsaXQoJy8nKS5zbGljZSgwLCAzKS5qb2luKCcvJyk7XG4gICAgICB0aGlzLmF1dGh6U2VydmljZVVybCA9IGF1dGh6U2VydmljZVVybDtcbiAgICAgIHRoaXMudG9rZW5TZXJ2aWNlVXJsID0gdG9rZW5TZXJ2aWNlVXJsO1xuICAgICAgdGhpcy5yZXZva2VTZXJ2aWNlVXJsID1cbiAgICAgICAgcmV2b2tlU2VydmljZVVybCB8fCBgJHt0aGlzLmxvZ2luVXJsfS9zZXJ2aWNlcy9vYXV0aDIvcmV2b2tlYDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sb2dpblVybCA9IGxvZ2luVXJsIHx8IGRlZmF1bHRPQXV0aDJDb25maWcubG9naW5Vcmw7XG4gICAgICB0aGlzLmF1dGh6U2VydmljZVVybCA9IGAke3RoaXMubG9naW5Vcmx9L3NlcnZpY2VzL29hdXRoMi9hdXRob3JpemVgO1xuICAgICAgdGhpcy50b2tlblNlcnZpY2VVcmwgPSBgJHt0aGlzLmxvZ2luVXJsfS9zZXJ2aWNlcy9vYXV0aDIvdG9rZW5gO1xuICAgICAgdGhpcy5yZXZva2VTZXJ2aWNlVXJsID0gYCR7dGhpcy5sb2dpblVybH0vc2VydmljZXMvb2F1dGgyL3Jldm9rZWA7XG4gICAgfVxuICAgIHRoaXMuY2xpZW50SWQgPSBjbGllbnRJZDtcbiAgICB0aGlzLmNsaWVudFNlY3JldCA9IGNsaWVudFNlY3JldDtcbiAgICB0aGlzLnJlZGlyZWN0VXJpID0gcmVkaXJlY3RVcmk7XG4gICAgaWYgKHByb3h5VXJsKSB7XG4gICAgICB0aGlzLl90cmFuc3BvcnQgPSBuZXcgWGRQcm94eVRyYW5zcG9ydChwcm94eVVybCk7XG4gICAgfSBlbHNlIGlmIChodHRwUHJveHkpIHtcbiAgICAgIHRoaXMuX3RyYW5zcG9ydCA9IG5ldyBIdHRwUHJveHlUcmFuc3BvcnQoaHR0cFByb3h5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fdHJhbnNwb3J0ID0gbmV3IFRyYW5zcG9ydCgpO1xuICAgIH1cbiAgICBpZiAodXNlVmVyaWZpZXIpIHtcbiAgICAgIC8vIFNldCBhIGNvZGUgdmVyaWZpZXIgc3RyaW5nIGZvciBPQXV0aCBhdXRob3JpemF0aW9uXG4gICAgICB0aGlzLmNvZGVWZXJpZmllciA9IGJhc2U2NFVybEVzY2FwZShcbiAgICAgICAgcmFuZG9tQnl0ZXMoTWF0aC5jZWlsKDEyOCkpLnRvU3RyaW5nKCdiYXNlNjQnKSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBTYWxlc2ZvcmNlIE9BdXRoMiBhdXRob3JpemF0aW9uIHBhZ2UgVVJMIHRvIHJlZGlyZWN0IHVzZXIgYWdlbnQuXG4gICAqL1xuICBnZXRBdXRob3JpemF0aW9uVXJsKHBhcmFtczogQXV0aHpSZXF1ZXN0UGFyYW1zID0ge30pIHtcbiAgICBpZiAodGhpcy5jb2RlVmVyaWZpZXIpIHtcbiAgICAgIC8vIGNvZGUgdmVyaWZpZXIgbXVzdCBiZSBhIGJhc2UgNjQgdXJsIGVuY29kZWQgaGFzaCBvZiAxMjggYnl0ZXMgb2YgcmFuZG9tIGRhdGEuIE91ciByYW5kb20gZGF0YSBpcyBhbHNvXG4gICAgICAvLyBiYXNlIDY0IHVybCBlbmNvZGVkLiBTZWUgQ29ubmVjdGlvbi5jcmVhdGUoKTtcbiAgICAgIGNvbnN0IGNvZGVDaGFsbGVuZ2UgPSBiYXNlNjRVcmxFc2NhcGUoXG4gICAgICAgIGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZSh0aGlzLmNvZGVWZXJpZmllcikuZGlnZXN0KCdiYXNlNjQnKSxcbiAgICAgICk7XG4gICAgICBwYXJhbXMuY29kZV9jaGFsbGVuZ2UgPSBjb2RlQ2hhbGxlbmdlO1xuICAgIH1cblxuICAgIGNvbnN0IF9wYXJhbXMgPSB7XG4gICAgICAuLi5wYXJhbXMsXG4gICAgICByZXNwb25zZV90eXBlOiAnY29kZScsXG4gICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICByZWRpcmVjdF91cmk6IHRoaXMucmVkaXJlY3RVcmksXG4gICAgfTtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5hdXRoelNlcnZpY2VVcmwgK1xuICAgICAgKHRoaXMuYXV0aHpTZXJ2aWNlVXJsLmluZGV4T2YoJz8nKSA+PSAwID8gJyYnIDogJz8nKSArXG4gICAgICBxdWVyeXN0cmluZy5zdHJpbmdpZnkoX3BhcmFtcyBhcyB7IFtuYW1lOiBzdHJpbmddOiBhbnkgfSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIE9BdXRoMiBSZWZyZXNoIFRva2VuIEZsb3dcbiAgICovXG4gIGFzeW5jIHJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8VG9rZW5SZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5jbGllbnRJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBPQXV0aDIgY2xpZW50IGlkIGluZm9ybWF0aW9uIGlzIHNwZWNpZmllZCcpO1xuICAgIH1cbiAgICBjb25zdCBwYXJhbXM6IHsgW3Byb3A6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAgICAgZ3JhbnRfdHlwZTogJ3JlZnJlc2hfdG9rZW4nLFxuICAgICAgcmVmcmVzaF90b2tlbjogcmVmcmVzaFRva2VuLFxuICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLFxuICAgIH07XG4gICAgaWYgKHRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgICBwYXJhbXMuY2xpZW50X3NlY3JldCA9IHRoaXMuY2xpZW50U2VjcmV0O1xuICAgIH1cbiAgICBjb25zdCByZXQgPSBhd2FpdCB0aGlzLl9wb3N0UGFyYW1zKHBhcmFtcyk7XG4gICAgcmV0dXJuIHJldCBhcyBUb2tlblJlc3BvbnNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgYWNjZXNzIHRva2VuIHJlcXVlc3QgdG8gdGhlIHRva2VuIGVuZHBvaW50LlxuICAgKiBXaGVuIGEgY29kZSAoc3RyaW5nKSBpcyBwYXNzZWQgaW4gZmlyc3QgYXJndW1lbnQsIGl0IHdpbGwgdXNlIFdlYiBTZXJ2ZXIgQXV0aGVudGljYXRpb24gRmxvdyAoQXV0aG9yaXphdGlvbiBDb2RlIEdyYW50KS5cbiAgICogT3RoZXJ3aXNlLCBpdCB3aWxsIHVzZSB0aGUgc3BlY2lmaWVkIGBncmFudF90eXBlYCBhbmQgcGFzcyBwYXJhbWV0ZXJzIHRvIHRoZSBlbmRwb2ludC5cbiAgICovXG4gIGFzeW5jIHJlcXVlc3RUb2tlbihcbiAgICBjb2RlT3JQYXJhbXM6IHN0cmluZyB8IHsgZ3JhbnRfdHlwZTogc3RyaW5nOyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIH0sXG4gICAgcGFyYW1zOiB7IFtwcm9wOiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9LFxuICApOiBQcm9taXNlPFRva2VuUmVzcG9uc2U+IHtcbiAgICBpZiAoXG4gICAgICB0eXBlb2YgY29kZU9yUGFyYW1zID09PSAnc3RyaW5nJyAmJlxuICAgICAgKCF0aGlzLmNsaWVudElkIHx8ICF0aGlzLnJlZGlyZWN0VXJpKVxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnTm8gT0F1dGgyIGNsaWVudCBpZCBvciByZWRpcmVjdCB1cmkgY29uZmlndXJhdGlvbiBpcyBzcGVjaWZpZWQnLFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgX3BhcmFtczogeyBbcHJvcDogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICAgICAuLi5wYXJhbXMsXG4gICAgICAuLi4odHlwZW9mIGNvZGVPclBhcmFtcyA9PT0gJ3N0cmluZydcbiAgICAgICAgPyB7IGdyYW50X3R5cGU6ICdhdXRob3JpemF0aW9uX2NvZGUnLCBjb2RlOiBjb2RlT3JQYXJhbXMgfVxuICAgICAgICA6IGNvZGVPclBhcmFtcyksXG4gICAgfTtcbiAgICBpZiAodGhpcy5jbGllbnRJZCkge1xuICAgICAgX3BhcmFtcy5jbGllbnRfaWQgPSB0aGlzLmNsaWVudElkO1xuICAgIH1cbiAgICBpZiAodGhpcy5jbGllbnRTZWNyZXQpIHtcbiAgICAgIF9wYXJhbXMuY2xpZW50X3NlY3JldCA9IHRoaXMuY2xpZW50U2VjcmV0O1xuICAgIH1cbiAgICBpZiAodGhpcy5yZWRpcmVjdFVyaSkge1xuICAgICAgX3BhcmFtcy5yZWRpcmVjdF91cmkgPSB0aGlzLnJlZGlyZWN0VXJpO1xuICAgIH1cbiAgICBjb25zdCByZXQgPSBhd2FpdCB0aGlzLl9wb3N0UGFyYW1zKF9wYXJhbXMpO1xuICAgIHJldHVybiByZXQgYXMgVG9rZW5SZXNwb25zZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPQXV0aDIgVXNlcm5hbWUtUGFzc3dvcmQgRmxvdyAoUmVzb3VyY2UgT3duZXIgUGFzc3dvcmQgQ3JlZGVudGlhbHMpXG4gICAqL1xuICBhc3luYyBhdXRoZW50aWNhdGUoXG4gICAgdXNlcm5hbWU6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICApOiBQcm9taXNlPFRva2VuUmVzcG9uc2U+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50SWQgfHwgIXRoaXMuY2xpZW50U2VjcmV0IHx8ICF0aGlzLnJlZGlyZWN0VXJpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHZhbGlkIE9BdXRoMiBjbGllbnQgY29uZmlndXJhdGlvbiBzZXQnKTtcbiAgICB9XG4gICAgY29uc3QgcmV0ID0gYXdhaXQgdGhpcy5fcG9zdFBhcmFtcyh7XG4gICAgICBncmFudF90eXBlOiAncGFzc3dvcmQnLFxuICAgICAgdXNlcm5hbWUsXG4gICAgICBwYXNzd29yZCxcbiAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIGNsaWVudF9zZWNyZXQ6IHRoaXMuY2xpZW50U2VjcmV0LFxuICAgICAgcmVkaXJlY3RfdXJpOiB0aGlzLnJlZGlyZWN0VXJpLFxuICAgIH0pO1xuICAgIHJldHVybiByZXQgYXMgVG9rZW5SZXNwb25zZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPQXV0aDIgUmV2b2tlIFNlc3Npb24gVG9rZW5cbiAgICovXG4gIGFzeW5jIHJldm9rZVRva2VuKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX3RyYW5zcG9ydC5odHRwUmVxdWVzdCh7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHVybDogdGhpcy5yZXZva2VTZXJ2aWNlVXJsLFxuICAgICAgYm9keTogcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHsgdG9rZW4gfSksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPj0gNDAwKSB7XG4gICAgICBsZXQgcmVzOiBhbnkgPSBxdWVyeXN0cmluZy5wYXJzZShyZXNwb25zZS5ib2R5KTtcbiAgICAgIGlmICghcmVzIHx8ICFyZXMuZXJyb3IpIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgIGVycm9yOiBgRVJST1JfSFRUUF8ke3Jlc3BvbnNlLnN0YXR1c0NvZGV9YCxcbiAgICAgICAgICBlcnJvcl9kZXNjcmlwdGlvbjogcmVzcG9uc2UuYm9keSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyAoY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gICAgICAgIGNvbnN0cnVjdG9yKHtcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBlcnJvcl9kZXNjcmlwdGlvbixcbiAgICAgICAgfToge1xuICAgICAgICAgIGVycm9yOiBzdHJpbmc7XG4gICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgfSkge1xuICAgICAgICAgIHN1cGVyKGVycm9yX2Rlc2NyaXB0aW9uKTtcbiAgICAgICAgICB0aGlzLm5hbWUgPSBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgfSkocmVzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGFzeW5jIF9wb3N0UGFyYW1zKHBhcmFtczogeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIH0pOiBQcm9taXNlPGFueT4ge1xuICAgIGlmICh0aGlzLmNvZGVWZXJpZmllcikgcGFyYW1zLmNvZGVfdmVyaWZpZXIgPSB0aGlzLmNvZGVWZXJpZmllcjtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fdHJhbnNwb3J0Lmh0dHBSZXF1ZXN0KHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgdXJsOiB0aGlzLnRva2VuU2VydmljZVVybCxcbiAgICAgIGJvZHk6IHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShwYXJhbXMpLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGxldCByZXM7XG4gICAgdHJ5IHtcbiAgICAgIHJlcyA9IEpTT04ucGFyc2UocmVzcG9uc2UuYm9keSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tZW1wdHkgKi9cbiAgICB9XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPj0gNDAwKSB7XG4gICAgICByZXMgPSByZXMgfHwge1xuICAgICAgICBlcnJvcjogYEVSUk9SX0hUVFBfJHtyZXNwb25zZS5zdGF0dXNDb2RlfWAsXG4gICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiByZXNwb25zZS5ib2R5LFxuICAgICAgfTtcbiAgICAgIHRocm93IG5ldyAoY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gICAgICAgIGNvbnN0cnVjdG9yKHtcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBlcnJvcl9kZXNjcmlwdGlvbixcbiAgICAgICAgfToge1xuICAgICAgICAgIGVycm9yOiBzdHJpbmc7XG4gICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgfSkge1xuICAgICAgICAgIHN1cGVyKGVycm9yX2Rlc2NyaXB0aW9uKTtcbiAgICAgICAgICB0aGlzLm5hbWUgPSBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgfSkocmVzKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBPQXV0aDI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBLElBQUFBLE9BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFlBQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFHLFVBQUEsR0FBQUMsdUJBQUEsQ0FBQUosT0FBQTtBQUE4RSxTQUFBSyxRQUFBQyxNQUFBLEVBQUFDLGNBQUEsUUFBQUMsSUFBQSxHQUFBQyxZQUFBLENBQUFILE1BQUEsT0FBQUksNkJBQUEsUUFBQUMsT0FBQSxHQUFBRCw2QkFBQSxDQUFBSixNQUFBLE9BQUFDLGNBQUEsRUFBQUksT0FBQSxHQUFBQyx1QkFBQSxDQUFBRCxPQUFBLEVBQUFFLElBQUEsQ0FBQUYsT0FBQSxZQUFBRyxHQUFBLFdBQUFDLGdDQUFBLENBQUFULE1BQUEsRUFBQVEsR0FBQSxFQUFBRSxVQUFBLE1BQUFSLElBQUEsQ0FBQVMsSUFBQSxDQUFBQyxLQUFBLENBQUFWLElBQUEsRUFBQUcsT0FBQSxZQUFBSCxJQUFBO0FBQUEsU0FBQVcsY0FBQUMsTUFBQSxhQUFBQyxDQUFBLE1BQUFBLENBQUEsR0FBQUMsU0FBQSxDQUFBQyxNQUFBLEVBQUFGLENBQUEsVUFBQUcsTUFBQSxHQUFBRixTQUFBLENBQUFELENBQUEsWUFBQUMsU0FBQSxDQUFBRCxDQUFBLFlBQUFBLENBQUEsWUFBQUksU0FBQSxFQUFBQyx3QkFBQSxDQUFBRCxTQUFBLEdBQUFwQixPQUFBLENBQUFzQixNQUFBLENBQUFILE1BQUEsVUFBQVgsSUFBQSxDQUFBWSxTQUFBLFlBQUFHLEdBQUEsUUFBQUMsZ0JBQUEsQ0FBQUMsT0FBQSxF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