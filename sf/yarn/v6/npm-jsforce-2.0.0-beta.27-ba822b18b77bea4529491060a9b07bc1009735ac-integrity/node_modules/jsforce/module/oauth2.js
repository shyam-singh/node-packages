import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import "core-js/modules/es.promise";
import "core-js/modules/es.string.replace";
import _indexOfInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/index-of";
import _sliceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/slice";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source), true)).call(_context3, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context4; _forEachInstanceProperty(_context4 = ownKeys(Object(source))).call(_context4, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
/**
 *
 */
import { createHash, randomBytes } from 'crypto';
import querystring from 'querystring';
import Transport, { XdProxyTransport, HttpProxyTransport } from './transport';
const defaultOAuth2Config = {
  loginUrl: 'https://login.salesforce.com'
};

// Makes a nodejs base64 encoded string compatible with rfc4648 alternative encoding for urls.
// @param base64Encoded a nodejs base64 encoded string
function base64UrlEscape(base64Encoded) {
  // builtin node js base 64 encoding is not 64 url compatible.
  // See https://toolsn.ietf.org/html/rfc4648#section-5
  return base64Encoded.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
}

/**
 * type defs
 */

/**
 * OAuth2 class
 */
export class OAuth2 {
  /**
   *
   */
  constructor(config) {
    _defineProperty(this, "loginUrl", void 0);
    _defineProperty(this, "authzServiceUrl", void 0);
    _defineProperty(this, "tokenServiceUrl", void 0);
    _defineProperty(this, "revokeServiceUrl", void 0);
    _defineProperty(this, "clientId", void 0);
    _defineProperty(this, "clientSecret", void 0);
    _defineProperty(this, "redirectUri", void 0);
    _defineProperty(this, "codeVerifier", void 0);
    _defineProperty(this, "_transport", void 0);
    const {
      loginUrl,
      authzServiceUrl,
      tokenServiceUrl,
      revokeServiceUrl,
      clientId,
      clientSecret,
      redirectUri,
      proxyUrl,
      httpProxy,
      useVerifier
    } = config;
    if (authzServiceUrl && tokenServiceUrl) {
      var _context;
      this.loginUrl = _sliceInstanceProperty(_context = authzServiceUrl.split('/')).call(_context, 0, 3).join('/');
      this.authzServiceUrl = authzServiceUrl;
      this.tokenServiceUrl = tokenServiceUrl;
      this.revokeServiceUrl = revokeServiceUrl || `${this.loginUrl}/services/oauth2/revoke`;
    } else {
      this.loginUrl = loginUrl || defaultOAuth2Config.loginUrl;
      this.authzServiceUrl = `${this.loginUrl}/services/oauth2/authorize`;
      this.tokenServiceUrl = `${this.loginUrl}/services/oauth2/token`;
      this.revokeServiceUrl = `${this.loginUrl}/services/oauth2/revoke`;
    }
    this.clientId = clientId;
    this.clientSecret = clientSecret;
    this.redirectUri = redirectUri;
    if (proxyUrl) {
      this._transport = new XdProxyTransport(proxyUrl);
    } else if (httpProxy) {
      this._transport = new HttpProxyTransport(httpProxy);
    } else {
      this._transport = new Transport();
    }
    if (useVerifier) {
      // Set a code verifier string for OAuth authorization
      this.codeVerifier = base64UrlEscape(randomBytes(Math.ceil(128)).toString('base64'));
    }
  }

  /**
   * Get Salesforce OAuth2 authorization page URL to redirect user agent.
   */
  getAuthorizationUrl(params = {}) {
    var _context2;
    if (this.codeVerifier) {
      // code verifier must be a base 64 url encoded hash of 128 bytes of random data. Our random data is also
      // base 64 url encoded. See Connection.create();
      const codeChallenge = base64UrlEscape(createHash('sha256').update(this.codeVerifier).digest('base64'));
      params.code_challenge = codeChallenge;
    }
    const _params = _objectSpread(_objectSpread({}, params), {}, {
      response_type: 'code',
      client_id: this.clientId,
      redirect_uri: this.redirectUri
    });
    return this.authzServiceUrl + (_indexOfInstanceProperty(_context2 = this.authzServiceUrl).call(_context2, '?') >= 0 ? '&' : '?') + querystring.stringify(_params);
  }

  /**
   * OAuth2 Refresh Token Flow
   */
  async refreshToken(refreshToken) {
    if (!this.clientId) {
      throw new Error('No OAuth2 client id information is specified');
    }
    const params = {
      grant_type: 'refresh_token',
      refresh_token: refreshToken,
      client_id: this.clientId
    };
    if (this.clientSecret) {
      params.client_secret = this.clientSecret;
    }
    const ret = await this._postParams(params);
    return ret;
  }

  /**
   * Send access token request to the token endpoint.
   * When a code (string) is passed in first argument, it will use Web Server Authentication Flow (Authorization Code Grant).
   * Otherwise, it will use the specified `grant_type` and pass parameters to the endpoint.
   */
  async requestToken(codeOrParams, params = {}) {
    if (typeof codeOrParams === 'string' && (!this.clientId || !this.redirectUri)) {
      throw new Error('No OAuth2 client id or redirect uri configuration is specified');
    }
    const _params = _objectSpread(_objectSpread({}, params), typeof codeOrParams === 'string' ? {
      grant_type: 'authorization_code',
      code: codeOrParams
    } : codeOrParams);
    if (this.clientId) {
      _params.client_id = this.clientId;
    }
    if (this.clientSecret) {
      _params.client_secret = this.clientSecret;
    }
    if (this.redirectUri) {
      _params.redirect_uri = this.redirectUri;
    }
    const ret = await this._postParams(_params);
    return ret;
  }

  /**
   * OAuth2 Username-Password Flow (Resource Owner Password Credentials)
   */
  async authenticate(username, password) {
    if (!this.clientId || !this.clientSecret || !this.redirectUri) {
      throw new Error('No valid OAuth2 client configuration set');
    }
    const ret = await this._postParams({
      grant_type: 'password',
      username,
      password,
      client_id: this.clientId,
      client_secret: this.clientSecret,
      redirect_uri: this.redirectUri
    });
    return ret;
  }

  /**
   * OAuth2 Revoke Session Token
   */
  async revokeToken(token) {
    const response = await this._transport.httpRequest({
      method: 'POST',
      url: this.revokeServiceUrl,
      body: querystring.stringify({
        token
      }),
      headers: {
        'content-type': 'application/x-www-form-urlencoded'
      }
    });
    if (response.statusCode >= 400) {
      let res = querystring.parse(response.body);
      if (!res || !res.error) {
        res = {
          error: `ERROR_HTTP_${response.statusCode}`,
          error_description: response.body
        };
      }
      throw new class extends Error {
        constructor({
          error,
          error_description
        }) {
          super(error_description);
          this.name = error;
        }
      }(res);
    }
  }

  /**
   * @private
   */
  async _postParams(params) {
    if (this.codeVerifier) params.code_verifier = this.codeVerifier;
    const response = await this._transport.httpRequest({
      method: 'POST',
      url: this.tokenServiceUrl,
      body: querystring.stringify(params),
      headers: {
        'content-type': 'application/x-www-form-urlencoded'
      }
    });
    let res;
    try {
      res = JSON.parse(response.body);
    } catch (e) {
      /* eslint-disable no-empty */
    }
    if (response.statusCode >= 400) {
      res = res || {
        error: `ERROR_HTTP_${response.statusCode}`,
        error_description: response.body
      };
      throw new class extends Error {
        constructor({
          error,
          error_description
        }) {
          super(error_description);
          this.name = error;
        }
      }(res);
    }
    return res;
  }
}
export default OAuth2;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVIYXNoIiwicmFuZG9tQnl0ZXMiLCJxdWVyeXN0cmluZyIsIlRyYW5zcG9ydCIsIlhkUHJveHlUcmFuc3BvcnQiLCJIdHRwUHJveHlUcmFuc3BvcnQiLCJkZWZhdWx0T0F1dGgyQ29uZmlnIiwibG9naW5VcmwiLCJiYXNlNjRVcmxFc2NhcGUiLCJiYXNlNjRFbmNvZGVkIiwicmVwbGFjZSIsIk9BdXRoMiIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiX2RlZmluZVByb3BlcnR5IiwiYXV0aHpTZXJ2aWNlVXJsIiwidG9rZW5TZXJ2aWNlVXJsIiwicmV2b2tlU2VydmljZVVybCIsImNsaWVudElkIiwiY2xpZW50U2VjcmV0IiwicmVkaXJlY3RVcmkiLCJwcm94eVVybCIsImh0dHBQcm94eSIsInVzZVZlcmlmaWVyIiwiX2NvbnRleHQiLCJfc2xpY2VJbnN0YW5jZVByb3BlcnR5Iiwic3BsaXQiLCJjYWxsIiwiam9pbiIsIl90cmFuc3BvcnQiLCJjb2RlVmVyaWZpZXIiLCJNYXRoIiwiY2VpbCIsInRvU3RyaW5nIiwiZ2V0QXV0aG9yaXphdGlvblVybCIsInBhcmFtcyIsIl9jb250ZXh0MiIsImNvZGVDaGFsbGVuZ2UiLCJ1cGRhdGUiLCJkaWdlc3QiLCJjb2RlX2NoYWxsZW5nZSIsIl9wYXJhbXMiLCJfb2JqZWN0U3ByZWFkIiwicmVzcG9uc2VfdHlwZSIsImNsaWVudF9pZCIsInJlZGlyZWN0X3VyaSIsIl9pbmRleE9mSW5zdGFuY2VQcm9wZXJ0eSIsInN0cmluZ2lmeSIsInJlZnJlc2hUb2tlbiIsIkVycm9yIiwiZ3JhbnRfdHlwZSIsInJlZnJlc2hfdG9rZW4iLCJjbGllbnRfc2VjcmV0IiwicmV0IiwiX3Bvc3RQYXJhbXMiLCJyZXF1ZXN0VG9rZW4iLCJjb2RlT3JQYXJhbXMiLCJjb2RlIiwiYXV0aGVudGljYXRlIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInJldm9rZVRva2VuIiwidG9rZW4iLCJyZXNwb25zZSIsImh0dHBSZXF1ZXN0IiwibWV0aG9kIiwidXJsIiwiYm9keSIsImhlYWRlcnMiLCJzdGF0dXNDb2RlIiwicmVzIiwicGFyc2UiLCJlcnJvciIsImVycm9yX2Rlc2NyaXB0aW9uIiwibmFtZSIsImNvZGVfdmVyaWZpZXIiLCJKU09OIiwiZSJdLCJzb3VyY2VzIjpbIi4uL3NyYy9vYXV0aDIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICovXG5pbXBvcnQgeyBjcmVhdGVIYXNoLCByYW5kb21CeXRlcyB9IGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgcXVlcnlzdHJpbmcgZnJvbSAncXVlcnlzdHJpbmcnO1xuaW1wb3J0IFRyYW5zcG9ydCwgeyBYZFByb3h5VHJhbnNwb3J0LCBIdHRwUHJveHlUcmFuc3BvcnQgfSBmcm9tICcuL3RyYW5zcG9ydCc7XG5pbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBkZWZhdWx0T0F1dGgyQ29uZmlnID0ge1xuICBsb2dpblVybDogJ2h0dHBzOi8vbG9naW4uc2FsZXNmb3JjZS5jb20nLFxufTtcblxuLy8gTWFrZXMgYSBub2RlanMgYmFzZTY0IGVuY29kZWQgc3RyaW5nIGNvbXBhdGlibGUgd2l0aCByZmM0NjQ4IGFsdGVybmF0aXZlIGVuY29kaW5nIGZvciB1cmxzLlxuLy8gQHBhcmFtIGJhc2U2NEVuY29kZWQgYSBub2RlanMgYmFzZTY0IGVuY29kZWQgc3RyaW5nXG5mdW5jdGlvbiBiYXNlNjRVcmxFc2NhcGUoYmFzZTY0RW5jb2RlZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gYnVpbHRpbiBub2RlIGpzIGJhc2UgNjQgZW5jb2RpbmcgaXMgbm90IDY0IHVybCBjb21wYXRpYmxlLlxuICAvLyBTZWUgaHR0cHM6Ly90b29sc24uaWV0Zi5vcmcvaHRtbC9yZmM0NjQ4I3NlY3Rpb24tNVxuICByZXR1cm4gYmFzZTY0RW5jb2RlZFxuICAgIC5yZXBsYWNlKC9cXCsvZywgJy0nKVxuICAgIC5yZXBsYWNlKC9cXC8vZywgJ18nKVxuICAgIC5yZXBsYWNlKC89L2csICcnKTtcbn1cblxuLyoqXG4gKiB0eXBlIGRlZnNcbiAqL1xuZXhwb3J0IHR5cGUgT0F1dGgyQ29uZmlnID0ge1xuICBjbGllbnRJZD86IHN0cmluZztcbiAgY2xpZW50U2VjcmV0Pzogc3RyaW5nO1xuICByZWRpcmVjdFVyaT86IHN0cmluZztcbiAgbG9naW5Vcmw/OiBzdHJpbmc7XG4gIGF1dGh6U2VydmljZVVybD86IHN0cmluZztcbiAgdG9rZW5TZXJ2aWNlVXJsPzogc3RyaW5nO1xuICByZXZva2VTZXJ2aWNlVXJsPzogc3RyaW5nO1xuICBwcm94eVVybD86IHN0cmluZztcbiAgaHR0cFByb3h5Pzogc3RyaW5nO1xuICB1c2VWZXJpZmllcj86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBBdXRoelJlcXVlc3RQYXJhbXMgPSB7XG4gIHNjb3BlPzogc3RyaW5nO1xuICBzdGF0ZT86IHN0cmluZztcbiAgY29kZV9jaGFsbGVuZ2U/OiBzdHJpbmc7XG59ICYge1xuICBbYXR0cjogc3RyaW5nXTogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgVG9rZW5SZXNwb25zZSA9IHtcbiAgdG9rZW5fdHlwZTogJ0JlYXJlcic7XG4gIGlkOiBzdHJpbmc7XG4gIGFjY2Vzc190b2tlbjogc3RyaW5nO1xuICByZWZyZXNoX3Rva2VuPzogc3RyaW5nO1xuICBzaWduYXR1cmU6IHN0cmluZztcbiAgaXNzdWVkX2F0OiBzdHJpbmc7XG4gIGluc3RhbmNlX3VybDogc3RyaW5nO1xuICBzZmRjX2NvbW11bml0eV91cmw/OiBzdHJpbmc7XG4gIHNmZGNfY29tbXVuaXR5X2lkPzogc3RyaW5nO1xufTtcblxuLyoqXG4gKiBPQXV0aDIgY2xhc3NcbiAqL1xuZXhwb3J0IGNsYXNzIE9BdXRoMiB7XG4gIGxvZ2luVXJsOiBzdHJpbmc7XG4gIGF1dGh6U2VydmljZVVybDogc3RyaW5nO1xuICB0b2tlblNlcnZpY2VVcmw6IHN0cmluZztcbiAgcmV2b2tlU2VydmljZVVybDogc3RyaW5nO1xuICBjbGllbnRJZDogT3B0aW9uYWw8c3RyaW5nPjtcbiAgY2xpZW50U2VjcmV0OiBPcHRpb25hbDxzdHJpbmc+O1xuICByZWRpcmVjdFVyaTogT3B0aW9uYWw8c3RyaW5nPjtcbiAgY29kZVZlcmlmaWVyOiBPcHRpb25hbDxzdHJpbmc+O1xuXG4gIF90cmFuc3BvcnQ6IFRyYW5zcG9ydDtcblxuICAvKipcbiAgICpcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogT0F1dGgyQ29uZmlnKSB7XG4gICAgY29uc3Qge1xuICAgICAgbG9naW5VcmwsXG4gICAgICBhdXRoelNlcnZpY2VVcmwsXG4gICAgICB0b2tlblNlcnZpY2VVcmwsXG4gICAgICByZXZva2VTZXJ2aWNlVXJsLFxuICAgICAgY2xpZW50SWQsXG4gICAgICBjbGllbnRTZWNyZXQsXG4gICAgICByZWRpcmVjdFVyaSxcbiAgICAgIHByb3h5VXJsLFxuICAgICAgaHR0cFByb3h5LFxuICAgICAgdXNlVmVyaWZpZXIsXG4gICAgfSA9IGNvbmZpZztcbiAgICBpZiAoYXV0aHpTZXJ2aWNlVXJsICYmIHRva2VuU2VydmljZVVybCkge1xuICAgICAgdGhpcy5sb2dpblVybCA9IGF1dGh6U2VydmljZVVybC5zcGxpdCgnLycpLnNsaWNlKDAsIDMpLmpvaW4oJy8nKTtcbiAgICAgIHRoaXMuYXV0aHpTZXJ2aWNlVXJsID0gYXV0aHpTZXJ2aWNlVXJsO1xuICAgICAgdGhpcy50b2tlblNlcnZpY2VVcmwgPSB0b2tlblNlcnZpY2VVcmw7XG4gICAgICB0aGlzLnJldm9rZVNlcnZpY2VVcmwgPVxuICAgICAgICByZXZva2VTZXJ2aWNlVXJsIHx8IGAke3RoaXMubG9naW5Vcmx9L3NlcnZpY2VzL29hdXRoMi9yZXZva2VgO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZ2luVXJsID0gbG9naW5VcmwgfHwgZGVmYXVsdE9BdXRoMkNvbmZpZy5sb2dpblVybDtcbiAgICAgIHRoaXMuYXV0aHpTZXJ2aWNlVXJsID0gYCR7dGhpcy5sb2dpblVybH0vc2VydmljZXMvb2F1dGgyL2F1dGhvcml6ZWA7XG4gICAgICB0aGlzLnRva2VuU2VydmljZVVybCA9IGAke3RoaXMubG9naW5Vcmx9L3NlcnZpY2VzL29hdXRoMi90b2tlbmA7XG4gICAgICB0aGlzLnJldm9rZVNlcnZpY2VVcmwgPSBgJHt0aGlzLmxvZ2luVXJsfS9zZXJ2aWNlcy9vYXV0aDIvcmV2b2tlYDtcbiAgICB9XG4gICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkO1xuICAgIHRoaXMuY2xpZW50U2VjcmV0ID0gY2xpZW50U2VjcmV0O1xuICAgIHRoaXMucmVkaXJlY3RVcmkgPSByZWRpcmVjdFVyaTtcbiAgICBpZiAocHJveHlVcmwpIHtcbiAgICAgIHRoaXMuX3RyYW5zcG9ydCA9IG5ldyBYZFByb3h5VHJhbnNwb3J0KHByb3h5VXJsKTtcbiAgICB9IGVsc2UgaWYgKGh0dHBQcm94eSkge1xuICAgICAgdGhpcy5fdHJhbnNwb3J0ID0gbmV3IEh0dHBQcm94eVRyYW5zcG9ydChodHRwUHJveHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl90cmFuc3BvcnQgPSBuZXcgVHJhbnNwb3J0KCk7XG4gICAgfVxuICAgIGlmICh1c2VWZXJpZmllcikge1xuICAgICAgLy8gU2V0IGEgY29kZSB2ZXJpZmllciBzdHJpbmcgZm9yIE9BdXRoIGF1dGhvcml6YXRpb25cbiAgICAgIHRoaXMuY29kZVZlcmlmaWVyID0gYmFzZTY0VXJsRXNjYXBlKFxuICAgICAgICByYW5kb21CeXRlcyhNYXRoLmNlaWwoMTI4KSkudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IFNhbGVzZm9yY2UgT0F1dGgyIGF1dGhvcml6YXRpb24gcGFnZSBVUkwgdG8gcmVkaXJlY3QgdXNlciBhZ2VudC5cbiAgICovXG4gIGdldEF1dGhvcml6YXRpb25VcmwocGFyYW1zOiBBdXRoelJlcXVlc3RQYXJhbXMgPSB7fSkge1xuICAgIGlmICh0aGlzLmNvZGVWZXJpZmllcikge1xuICAgICAgLy8gY29kZSB2ZXJpZmllciBtdXN0IGJlIGEgYmFzZSA2NCB1cmwgZW5jb2RlZCBoYXNoIG9mIDEyOCBieXRlcyBvZiByYW5kb20gZGF0YS4gT3VyIHJhbmRvbSBkYXRhIGlzIGFsc29cbiAgICAgIC8vIGJhc2UgNjQgdXJsIGVuY29kZWQuIFNlZSBDb25uZWN0aW9uLmNyZWF0ZSgpO1xuICAgICAgY29uc3QgY29kZUNoYWxsZW5nZSA9IGJhc2U2NFVybEVzY2FwZShcbiAgICAgICAgY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHRoaXMuY29kZVZlcmlmaWVyKS5kaWdlc3QoJ2Jhc2U2NCcpLFxuICAgICAgKTtcbiAgICAgIHBhcmFtcy5jb2RlX2NoYWxsZW5nZSA9IGNvZGVDaGFsbGVuZ2U7XG4gICAgfVxuXG4gICAgY29uc3QgX3BhcmFtcyA9IHtcbiAgICAgIC4uLnBhcmFtcyxcbiAgICAgIHJlc3BvbnNlX3R5cGU6ICdjb2RlJyxcbiAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCxcbiAgICAgIHJlZGlyZWN0X3VyaTogdGhpcy5yZWRpcmVjdFVyaSxcbiAgICB9O1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLmF1dGh6U2VydmljZVVybCArXG4gICAgICAodGhpcy5hdXRoelNlcnZpY2VVcmwuaW5kZXhPZignPycpID49IDAgPyAnJicgOiAnPycpICtcbiAgICAgIHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShfcGFyYW1zIGFzIHsgW25hbWU6IHN0cmluZ106IGFueSB9KVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogT0F1dGgyIFJlZnJlc2ggVG9rZW4gRmxvd1xuICAgKi9cbiAgYXN5bmMgcmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbjogc3RyaW5nKTogUHJvbWlzZTxUb2tlblJlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudElkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIE9BdXRoMiBjbGllbnQgaWQgaW5mb3JtYXRpb24gaXMgc3BlY2lmaWVkJyk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtczogeyBbcHJvcDogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICAgICBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsXG4gICAgICByZWZyZXNoX3Rva2VuOiByZWZyZXNoVG9rZW4sXG4gICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgfTtcbiAgICBpZiAodGhpcy5jbGllbnRTZWNyZXQpIHtcbiAgICAgIHBhcmFtcy5jbGllbnRfc2VjcmV0ID0gdGhpcy5jbGllbnRTZWNyZXQ7XG4gICAgfVxuICAgIGNvbnN0IHJldCA9IGF3YWl0IHRoaXMuX3Bvc3RQYXJhbXMocGFyYW1zKTtcbiAgICByZXR1cm4gcmV0IGFzIFRva2VuUmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhY2Nlc3MgdG9rZW4gcmVxdWVzdCB0byB0aGUgdG9rZW4gZW5kcG9pbnQuXG4gICAqIFdoZW4gYSBjb2RlIChzdHJpbmcpIGlzIHBhc3NlZCBpbiBmaXJzdCBhcmd1bWVudCwgaXQgd2lsbCB1c2UgV2ViIFNlcnZlciBBdXRoZW50aWNhdGlvbiBGbG93IChBdXRob3JpemF0aW9uIENvZGUgR3JhbnQpLlxuICAgKiBPdGhlcndpc2UsIGl0IHdpbGwgdXNlIHRoZSBzcGVjaWZpZWQgYGdyYW50X3R5cGVgIGFuZCBwYXNzIHBhcmFtZXRlcnMgdG8gdGhlIGVuZHBvaW50LlxuICAgKi9cbiAgYXN5bmMgcmVxdWVzdFRva2VuKFxuICAgIGNvZGVPclBhcmFtczogc3RyaW5nIHwgeyBncmFudF90eXBlOiBzdHJpbmc7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfSxcbiAgICBwYXJhbXM6IHsgW3Byb3A6IHN0cmluZ106IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8VG9rZW5SZXNwb25zZT4ge1xuICAgIGlmIChcbiAgICAgIHR5cGVvZiBjb2RlT3JQYXJhbXMgPT09ICdzdHJpbmcnICYmXG4gICAgICAoIXRoaXMuY2xpZW50SWQgfHwgIXRoaXMucmVkaXJlY3RVcmkpXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdObyBPQXV0aDIgY2xpZW50IGlkIG9yIHJlZGlyZWN0IHVyaSBjb25maWd1cmF0aW9uIGlzIHNwZWNpZmllZCcsXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBfcGFyYW1zOiB7IFtwcm9wOiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgICAgIC4uLnBhcmFtcyxcbiAgICAgIC4uLih0eXBlb2YgY29kZU9yUGFyYW1zID09PSAnc3RyaW5nJ1xuICAgICAgICA/IHsgZ3JhbnRfdHlwZTogJ2F1dGhvcml6YXRpb25fY29kZScsIGNvZGU6IGNvZGVPclBhcmFtcyB9XG4gICAgICAgIDogY29kZU9yUGFyYW1zKSxcbiAgICB9O1xuICAgIGlmICh0aGlzLmNsaWVudElkKSB7XG4gICAgICBfcGFyYW1zLmNsaWVudF9pZCA9IHRoaXMuY2xpZW50SWQ7XG4gICAgfVxuICAgIGlmICh0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgX3BhcmFtcy5jbGllbnRfc2VjcmV0ID0gdGhpcy5jbGllbnRTZWNyZXQ7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlZGlyZWN0VXJpKSB7XG4gICAgICBfcGFyYW1zLnJlZGlyZWN0X3VyaSA9IHRoaXMucmVkaXJlY3RVcmk7XG4gICAgfVxuICAgIGNvbnN0IHJldCA9IGF3YWl0IHRoaXMuX3Bvc3RQYXJhbXMoX3BhcmFtcyk7XG4gICAgcmV0dXJuIHJldCBhcyBUb2tlblJlc3BvbnNlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9BdXRoMiBVc2VybmFtZS1QYXNzd29yZCBGbG93IChSZXNvdXJjZSBPd25lciBQYXNzd29yZCBDcmVkZW50aWFscylcbiAgICovXG4gIGFzeW5jIGF1dGhlbnRpY2F0ZShcbiAgICB1c2VybmFtZTogc3RyaW5nLFxuICAgIHBhc3N3b3JkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8VG9rZW5SZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5jbGllbnRJZCB8fCAhdGhpcy5jbGllbnRTZWNyZXQgfHwgIXRoaXMucmVkaXJlY3RVcmkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdmFsaWQgT0F1dGgyIGNsaWVudCBjb25maWd1cmF0aW9uIHNldCcpO1xuICAgIH1cbiAgICBjb25zdCByZXQgPSBhd2FpdCB0aGlzLl9wb3N0UGFyYW1zKHtcbiAgICAgIGdyYW50X3R5cGU6ICdwYXNzd29yZCcsXG4gICAgICB1c2VybmFtZSxcbiAgICAgIHBhc3N3b3JkLFxuICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLFxuICAgICAgY2xpZW50X3NlY3JldDogdGhpcy5jbGllbnRTZWNyZXQsXG4gICAgICByZWRpcmVjdF91cmk6IHRoaXMucmVkaXJlY3RVcmksXG4gICAgfSk7XG4gICAgcmV0dXJuIHJldCBhcyBUb2tlblJlc3BvbnNlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9BdXRoMiBSZXZva2UgU2Vzc2lvbiBUb2tlblxuICAgKi9cbiAgYXN5bmMgcmV2b2tlVG9rZW4odG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fdHJhbnNwb3J0Lmh0dHBSZXF1ZXN0KHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgdXJsOiB0aGlzLnJldm9rZVNlcnZpY2VVcmwsXG4gICAgICBib2R5OiBxdWVyeXN0cmluZy5zdHJpbmdpZnkoeyB0b2tlbiB9KSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA+PSA0MDApIHtcbiAgICAgIGxldCByZXM6IGFueSA9IHF1ZXJ5c3RyaW5nLnBhcnNlKHJlc3BvbnNlLmJvZHkpO1xuICAgICAgaWYgKCFyZXMgfHwgIXJlcy5lcnJvcikge1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgZXJyb3I6IGBFUlJPUl9IVFRQXyR7cmVzcG9uc2Uuc3RhdHVzQ29kZX1gLFxuICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiByZXNwb25zZS5ib2R5LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IChjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgICAgICAgY29uc3RydWN0b3Ioe1xuICAgICAgICAgIGVycm9yLFxuICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uLFxuICAgICAgICB9OiB7XG4gICAgICAgICAgZXJyb3I6IHN0cmluZztcbiAgICAgICAgICBlcnJvcl9kZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgICAgICB9KSB7XG4gICAgICAgICAgc3VwZXIoZXJyb3JfZGVzY3JpcHRpb24pO1xuICAgICAgICAgIHRoaXMubmFtZSA9IGVycm9yO1xuICAgICAgICB9XG4gICAgICB9KShyZXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgYXN5bmMgX3Bvc3RQYXJhbXMocGFyYW1zOiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfSk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKHRoaXMuY29kZVZlcmlmaWVyKSBwYXJhbXMuY29kZV92ZXJpZmllciA9IHRoaXMuY29kZVZlcmlmaWVyO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl90cmFuc3BvcnQuaHR0cFJlcXVlc3Qoe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICB1cmw6IHRoaXMudG9rZW5TZXJ2aWNlVXJsLFxuICAgICAgYm9keTogcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHBhcmFtcyksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgbGV0IHJlcztcbiAgICB0cnkge1xuICAgICAgcmVzID0gSlNPTi5wYXJzZShyZXNwb25zZS5ib2R5KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1lbXB0eSAqL1xuICAgIH1cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA+PSA0MDApIHtcbiAgICAgIHJlcyA9IHJlcyB8fCB7XG4gICAgICAgIGVycm9yOiBgRVJST1JfSFRUUF8ke3Jlc3BvbnNlLnN0YXR1c0NvZGV9YCxcbiAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IHJlc3BvbnNlLmJvZHksXG4gICAgICB9O1xuICAgICAgdGhyb3cgbmV3IChjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgICAgICAgY29uc3RydWN0b3Ioe1xuICAgICAgICAgIGVycm9yLFxuICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uLFxuICAgICAgICB9OiB7XG4gICAgICAgICAgZXJyb3I6IHN0cmluZztcbiAgICAgICAgICBlcnJvcl9kZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgICAgICB9KSB7XG4gICAgICAgICAgc3VwZXIoZXJyb3JfZGVzY3JpcHRpb24pO1xuICAgICAgICAgIHRoaXMubmFtZSA9IGVycm9yO1xuICAgICAgICB9XG4gICAgICB9KShyZXMpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE9BdXRoMjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0EsU0FBU0EsVUFBVSxFQUFFQyxXQUFXLFFBQVEsUUFBUTtBQUNoRCxPQUFPQyxXQUFXLE1BQU0sYUFBYTtBQUNyQyxPQUFPQyxTQUFTLElBQUlDLGdCQUFnQixFQUFFQyxrQkFBa0IsUUFBUSxhQUFhO0FBRzdFLE1BQU1DLG1CQUFtQixHQUFHO0VBQzFCQyxRQUFRLEVBQUU7QUFDWixDQUFDOztBQUVEO0FBQ0E7QUFDQSxTQUFTQyxlQUFlQSxDQUFDQyxhQUFxQixFQUFVO0VBQ3REO0VBQ0E7RUFDQSxPQUFPQSxhQUFhLENBQ2pC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