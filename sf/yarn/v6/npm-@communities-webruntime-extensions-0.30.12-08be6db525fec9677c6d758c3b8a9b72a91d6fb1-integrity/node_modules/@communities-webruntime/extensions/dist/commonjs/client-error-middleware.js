"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Copyright (c) 2019, salesforce.com, inc.
 * All rights reserved.
 * SPDX-License-Identifier: MIT
 * For full license text, see the LICENSE file in the repo root or https://opensource.org/licenses/MIT
 */
const common_1 = require("@communities-webruntime/common");
const file_loggers_1 = require("./file-loggers");
function clientErrorMiddleware() {
    file_loggers_1.CLIENT_ERROR_LOGGER.clear();
    return (req, res, next) => {
        const { path: requestPath } = req;
        // skip to next when path prefix does not match
        if (!requestPath.startsWith(common_1.ERRORS_PATH_PREFIX)) {
            return next();
        }
        try {
            file_loggers_1.CLIENT_ERROR_LOGGER.log({
                timestamp: new Date().toISOString(),
                payload: JSON.parse(req.body),
            });
            return res.sendStatus(200);
        }
        catch (e) {
            return next(e);
        }
    };
}
exports.clientErrorMiddleware = clientErrorMiddleware;
//# sourceMappingURL=client-error-middleware.js.map