/**
 * Copyright (c) 2020, salesforce.com, inc.
 * All rights reserved.
 * SPDX-License-Identifier: MIT
 * For full license text, see the LICENSE file in the repo root or https://opensource.org/licenses/MIT
 */

import {
    addCSPErrorHandler,
    displayCspErrorsCaughtBeforeDesignModeInitialized,
} from '../../errorManager/errorManager';

/**
 * Starts an event listener for securitypolicyviolation event
 */
function startDocumentListeners(postMessageManager) {
    // Only add the CSP violation listener for Chrome since it's the only browser that supports
    // the correct value for the 'disposition' attribute for CSP3 that indicates if the violation
    // is 'enforce' vs 'report'.  For communities with Grandfathered CSP security policy, CSP
    // violations will be for reporting purposes only which should not be surfaced in the builder.
    if (window.cb_isChrome) {
        displayCspErrorsCaughtBeforeDesignModeInitialized(postMessageManager);
        addCSPErrorHandler(postMessageManager);
    }
}

export { startDocumentListeners };
