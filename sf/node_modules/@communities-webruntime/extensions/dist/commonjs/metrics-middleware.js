"use strict";
/**
 * Copyright (c) 2019, salesforce.com, inc.
 * All rights reserved.
 * SPDX-License-Identifier: MIT
 * For full license text, see the LICENSE file in the repo root or https://opensource.org/licenses/MIT
 */
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@communities-webruntime/common");
const file_loggers_1 = require("./file-loggers");
// clean up existing log on middleware load
file_loggers_1.METRICS_LOGGER.clear();
function metricsMiddleware() {
    return (req, res, next) => {
        const { path: requestPath } = req;
        // skip to next when path prefix does not match
        if (!requestPath.startsWith(common_1.METRICS_PATH_PREFIX)) {
            return next();
        }
        try {
            file_loggers_1.METRICS_LOGGER.log({
                timestamp: new Date().toISOString(),
                metricsResult: JSON.parse(req.body),
            });
            return res.sendStatus(200);
        }
        catch (err) {
            return next(err);
        }
    };
}
exports.metricsMiddleware = metricsMiddleware;
//# sourceMappingURL=metrics-middleware.js.map