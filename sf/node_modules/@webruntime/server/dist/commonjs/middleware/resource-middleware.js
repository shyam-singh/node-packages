"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const { warn } = console;
function createResourceMiddleware(instance, container) {
    return async (req, res) => {
        const { mode, locale } = req.params;
        try {
            // resolve the request url to a specifier
            const specifier = instance.toSpecifier(req.originalUrl);
            // build resource bundle for the specifier
            const bundle = await container.build(specifier, { mode, locale });
            res.type('js');
            bundle.getReadableStream().pipe(res);
        }
        catch (e) {
            warn(e);
            res.status(500).send({
                message: 'An unexpected error occurred',
                error: e.toString(),
            });
        }
    };
}
exports.createResourceMiddleware = createResourceMiddleware;
//# sourceMappingURL=resource-middleware.js.map