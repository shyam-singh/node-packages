"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const document_service_1 = require("../document/document-service");
function createPageMiddleware(pageDef, pageApp, container) {
    return (req, res, next) => {
        // Don't activate middleware if response is already committed
        if (res.headersSent) {
            return next();
        }
        return container.renderPage(req, pageDef, pageApp, res.locals).then(renderablePage => {
            res.set('Content-Type', renderablePage.page.contentType);
            res.send(document_service_1.getContent(renderablePage.page, renderablePage.resources, res.locals.nonce));
        });
    };
}
exports.createPageMiddleware = createPageMiddleware;
//# sourceMappingURL=page-middleware.js.map